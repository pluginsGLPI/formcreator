{#
 # ---------------------------------------------------------------------
 #
 # GLPI - Gestionnaire Libre de Parc Informatique
 #
 # http://glpi-project.org
 #
 # @copyright 2015-2025 Teclib' and contributors.
 # @licence   https://www.gnu.org/licenses/gpl-3.0.html
 #
 # ---------------------------------------------------------------------
 #
 # LICENSE
 #
 # This file is part of GLPI.
 #
 # This program is free software: you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
 # the Free Software Foundation, either version 3 of the License, or
 # (at your option) any later version.
 #
 # This program is distributed in the hope that it will be useful,
 # but WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 # GNU General Public License for more details.
 #
 # You should have received a copy of the GNU General Public License
 # along with this program.  If not, see <https://www.gnu.org/licenses/>.
 #
 # ---------------------------------------------------------------------
 #}

{% import 'components/form/fields_macros.html.twig' as fields %}

{# Page Header #}
<div class="d-flex align-items-center mb-4">
    <div class="me-3">
        <i class="fas fa-exchange-alt fa-2x text-primary"></i>
    </div>
    <div>
        <h1 class="mb-0">{{ __('Formcreator Migration Status', 'formcreator') }}</h1>
        <p class="text-muted mb-0">{{ __('End of Life migration tool for GLPI 11', 'formcreator') }}</p>
    </div>
</div>
    <div class="row">
        <div class="col-12">
            {# EOL Warning Banner #}
            <div class="alert alert-warning border-start border-warning border-4 mb-4">
                <div class="d-flex align-items-start">
                    <i class="fas fa-exclamation-triangle text-warning me-3 mt-1 fa-lg"></i>
                    <div>
                        <h5 class="alert-heading mb-2">{{ __('End of Life Notice', 'formcreator') }}</h5>
                        <p class="mb-0">
                            {{ __('Formcreator v3.0.0 is an End-of-Life version. All form creation functionality has been moved to GLPI 11 native forms.', 'formcreator') }}
                        </p>
                    </div>
                </div>
            </div>

            {# Migration Status Card #}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-chart-line me-2"></i>
                        {{ __('Migration Status', 'formcreator') }}
                    </h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0">
                            <tbody>
                                <tr>
                                    <td class="fw-bold">
                                        <i class="fas fa-forms me-2 text-primary"></i>
                                        {{ __('Legacy Forms Found', 'formcreator') }}
                                    </td>
                                    <td>
                                        <span class="badge glpi-badge">
                                            {{ form_count }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">
                                        <i class="fas fa-file-alt me-2 text-info"></i>
                                        {{ __('Legacy Form Submissions', 'formcreator') }}
                                    </td>
                                    <td>
                                        <span class="badge glpi-badge">
                                            {{ answer_count }}
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">
                                        <i class="fas fa-tasks me-2 text-success"></i>
                                        {{ __('Migration Status', 'formcreator') }}
                                    </td>
                                    <td>
                                        {% if migration_completed %}
                                            <span class="badge glpi-badge">
                                                <i class="fas fa-check me-1"></i>
                                                {{ __('Completed', 'formcreator') }}
                                            </span>
                                        {% elseif form_count > 0 %}
                                            <span class="badge glpi-badge">
                                                <i class="fas fa-clock me-1"></i>
                                                {{ __('Migration Available', 'formcreator') }}
                                            </span>
                                        {% else %}
                                            <span class="badge glpi-badge">
                                                <i class="fas fa-info me-1"></i>
                                                {{ __('No Data to Migrate', 'formcreator') }}
                                            </span>
                                        {% endif %}
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            {# Migration Action Card (only if migration is needed) #}
            {% if not migration_completed and form_count > 0 %}
                <div class="card shadow-sm mb-4 border-primary">
                    <div class="card-header bg-primary text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-play me-2"></i>
                            {{ __('Start Migration', 'formcreator') }}
                        </h3>
                    </div>
                    <div class="card-body">
                        <p class="lead mb-3">
                            {{ __('Click the button below to migrate your Formcreator forms to GLPI 11 native forms.', 'formcreator') }}
                        </p>
                        
                        <div class="alert alert-info border-start border-info border-4">
                            <h6 class="alert-heading">
                                <i class="fas fa-info-circle me-2"></i>
                                {{ __('Migration Process', 'formcreator') }}
                            </h6>
                            <ul class="mb-0 ps-3">
                                <li>{{ __('Form structure and fields will be converted', 'formcreator') }}</li>
                                <li>{{ __('Form categories will be preserved', 'formcreator') }}</li>
                                <li>{{ __('Access control rules will be migrated', 'formcreator') }}</li>
                                <li>{{ __('Form submissions will be preserved', 'formcreator') }}</li>
                                <li>{{ __('Complex validations may need manual recreation', 'formcreator') }}</li>
                            </ul>
                        </div>
                        
                        <form method="post" action="{{ current_url }}" class="mt-3">
                            <input type="hidden" name="_glpi_csrf_token" value="{{ csrf_token }}">
                            <button type="submit" name="start_migration" class="btn btn-primary btn-lg px-4">
                                <i class="fas fa-rocket me-2"></i>
                                {{ __('Start Migration to GLPI 11 Forms', 'formcreator') }}
                            </button>
                        </form>
                    </div>
                </div>
            {% endif %}

            {# Migration Progress Card (only shown during migration) #}
            {% if show_migration_progress %}
                <div class="card shadow-sm mb-4 border-success">
                    <div class="card-header bg-success text-white">
                        <h3 class="card-title mb-0">
                            <i class="fas fa-cogs me-2"></i>
                            {{ __('Migration Progress', 'formcreator') }}
                        </h3>
                    </div>
                    <div class="card-body">
                        {% if migration_error %}
                            <div class="alert alert-danger border-start border-danger border-4">
                                <div class="d-flex align-items-start">
                                    <i class="fas fa-exclamation-circle text-danger me-3 mt-1"></i>
                                    <div>
                                        <h6 class="alert-heading">{{ __('Migration Error', 'formcreator') }}</h6>
                                        <p class="mb-0">{{ migration_error }}</p>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <p>{{ __('Starting migration process...', 'formcreator') }}</p>
                            
                            <div class="alert alert-success border-start border-success border-4">
                                <div class="d-flex align-items-start">
                                    <i class="fas fa-check-circle text-success me-3 mt-1"></i>
                                    <div>
                                        <h6 class="alert-heading">{{ __('Migration Preparation Completed!', 'formcreator') }}</h6>
                                        <p class="mb-0">{{ __('Forms are ready for manual recreation in GLPI 11 native forms.', 'formcreator') }}</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-3">
                                <a href="/front/form.php" class="btn btn-success px-4">
                                    <i class="fas fa-external-link-alt me-2"></i>
                                    {{ __('Access GLPI 11 Forms', 'formcreator') }}
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}

            {# Next Steps Card #}
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h3 class="card-title mb-0">
                        <i class="fas fa-list-check me-2"></i>
                        {{ __('Next Steps', 'formcreator') }}
                    </h3>
                </div>
                <div class="card-body">
                    {% if migration_completed or form_count == 0 %}
                        <div class="alert alert-success border-start border-success border-4 mb-3">
                            <h6 class="alert-heading">
                                <i class="fas fa-check-circle me-2"></i>
                                {{ __('Migration Complete or No Data Found', 'formcreator') }}
                            </h6>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <i class="fas fa-arrow-right text-success me-2"></i>
                                        {{ __('Start using GLPI 11 native forms: Administration > Forms', 'formcreator') }}
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-arrow-right text-success me-2"></i>
                                        {{ __('Train users on the new form system', 'formcreator') }}
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <i class="fas fa-arrow-right text-success me-2"></i>
                                        {{ __('Update internal procedures and documentation', 'formcreator') }}
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-arrow-right text-success me-2"></i>
                                        {{ __('Consider uninstalling Formcreator plugin when ready', 'formcreator') }}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    {% else %}
                        <div class="alert alert-info border-start border-info border-4 mb-3">
                            <h6 class="alert-heading">
                                <i class="fas fa-info-circle me-2"></i>
                                {{ __('After Migration', 'formcreator') }}
                            </h6>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <i class="fas fa-arrow-right text-primary me-2"></i>
                                        {{ __('Review converted forms in GLPI 11', 'formcreator') }}
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-arrow-right text-primary me-2"></i>
                                        {{ __('Recreate complex validation rules manually if needed', 'formcreator') }}
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <i class="fas fa-arrow-right text-primary me-2"></i>
                                        {{ __('Test form access permissions', 'formcreator') }}
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-arrow-right text-primary me-2"></i>
                                        {{ __('Train users on GLPI 11 native forms', 'formcreator') }}
                                    </li>
                                </ul>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
